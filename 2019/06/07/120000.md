---
Title: バックアップは多重化するべきだと実感した話
Published: 2019/06/07 12:00:00
Tags:
  - "VPS、クラウド"
  - "パソコン"
  - "雑記"
Eyecatch: ""
---
普段大切なデータをどのようにバックアップしていますか？  

私の場合、大切なデータとしては

* 音楽ファイル(数年かけてレンタルなどして集めたCD音源のFLACファイルがだいたい400GBほど）  
* 写真(家族写真や旅行へ行った時の写真など、JPEGファイルとRAWファイル)  
* その他(電子書籍のPDFファイル(オライリーとか)など)  
があります。  

今回その大切なデータを失ってしまうところでした・・・。  



#### 普段のバックアップ方法  
基本的に大切なデータはPCではなく、NASに保管しています。  
RAIDを組んでいるのでPCよりも安全に保管できるためです。ただし、

[https://2502.net/raid-is-not-a-backup/:embed]

といった記事があるようにRAID=バックアップではないことに留意する必要があります。  
私の場合、自宅にあるNASが吹っ飛んでしまった時の対策として、実家にもNASを配置し、Resiio Syncを使ってインターネット経由でファイルのバックアップを取るようにしていました。  
が、あほなことに音楽ファイルだけしか実家NASにバックアップを取っていませんでした。  

[https://www.resilio.com/:embed]

写真データについてはAmazon Prime会員なので、Prime Driveの画像データ無制限特典が利用できることから、そちらにバックアップするようにしていました。  

#### ことの発端  

自宅で利用しているNASはNETGEARのReadyNASになります。初めて購入したNASで、スペック的には劣るものです。読み書きの速度があまりに遅くてイライラ・・・。    
それに対し、実家においてあるNASはQNAP製で、自宅のNASより性能が良い。読み書きの速度も申し分なし。  

普段使うNASのほうが性能が悪いのはさすがにちょっと・・・というわけで、自宅のNASと実家のNASを取り換えることにしました。  
また、どちらもRAID5だったので、性能と信頼性を鑑みてRAID10にすることに。  
この場合再構築ができなそうなので、いったんボリュームを消して、新規にRAIDを構築することにしました。  

ボリュームを消すのでデータをいったん退避する必要があります。  
PCの内蔵ストレージだとNASに保存していたファイルサイズ以上の空きがなかったので、現行メインPCを作り変える前に使用しており、今は不要となって外していたHDD(外付けケースに入れました)に一旦移すことに。  
思えば数年使っていたHDDにコピーを行ったのが間違いでした。  

#### フォーマットする必要があります  
バックアップが終わって、自宅NASを実家に持ち帰り、どちらのNASもボリュームを削除して再度構築し終えたので、いざ退避していたデータを元に戻そうと思い、HDDをPCに接続してコピー開始。  

途中までNASにコピーされていたのですが、突然コピーが失敗し、USB接続が切断されました。  
特に重たい処理やUSBケーブルを触るようなことをしていないのにと思いつつケーブルをさしなおしたところ、  

> ドライブ E: を使うにはフォーマットする必要があります。フォーマットしますか？  

のメッセージが。  
は？  
と思いもう一度つなぎなおしても、無情にも同じメッセージ。  

<?# Twitter 1136477127748927488 /?>

いやな予感しかしないままCrystalDiskInfoを起動してみたところ、ステータスが注意、不良セクタが200・・・。  

<?# Twitter 1136477529072476161 /?>

よりにもよってこのタイミングでHDDがお釈迦に・・・。  

#### 復旧
幸い音楽ファイルについては、先に自宅NASを初期化し終えて実家NASの初期化作業をする前に、NASからNASにコピーしていたので無事でした。    
写真データもPrime Photoにアップロードしてあるので、どうにかなりました。(ファイル更新日時がアップロードした日付になってしまって地味に辛い・・・)
が、残りのファイルはバックアップしていた記憶がありません。  

しかもあほなことにいきなり chkdsk /f をかけてしまったので、破損したところをがっしがっしとチェックディスクが消し込んでしまってフォルダ名やファイル名がぐちゃぐちゃに・・・。  
まただいぶ破損の程度が悪いようで、フリーの復旧ソフトだとあまり復旧できそうにない。  

<?# Twitter 1136483026072825856 /?>

<?# Twitter 1136483136764669954 /?>

割と途方に暮れつつ、仕方がないので破損HDDのクラスタ解析を行いつつ、Amazon Photoからファイルダウンロードをしていたのですが、ふとNASの管理画面をみてて、思い出しました。  

<?# Twitter 1136502482073374720 /?>

Office 365を契約して、OneDrive for Businessが使えるので、1TBの枠を何かに使えないかと思って、設定していたのでした。何気なく設定してたのでまったくそのことを覚えてなかった・・・。  
(そもそも普段Dropboxばかり使っていて、OneDriveを使うことがないので、同期されているかの確認もしてなかった)  

OneDriveを開くと、そこには消えてしまったと思っていたデータたちが。  
一か月ほど前にNASをいろいろいじった関係か、1か月前までのデータしかなかったのですが、この一か月以内にほとんどデータを保存してなかったこともあり、ほぼこれで取り返すことができました。  

#### 教訓  
本当に必要なデータなら、複数のバックアップ先を用意しましょう(白目)。  
そもそも実家NASにすべてのデータを同期させていればこんなことにはならなかったわけなんですが、バックアップが一つだけというのは本当に心もとないものだと認識しました。  
バックアップ先がぶっ壊れたら話にならないですね・・・。  
試験的に設定して、そのあとほったらかしにしていたOneDriveへのバックアップがなかったら、データが取り戻せないところでした。  

今後は実家NASへのフルバックアップと、クラウドへのバックアップを確実に行うようにしたいと思います。  
OneDriveの1TBだとNASの容量に満たないので、AWSのS3やAzureBlobも視野に入れようかと。   

<?# AmazonAffiliate B01N78FRVZ /?>

<?# AmazonAffiliate B07BB7VXNB /?>

<?# AmazonAffiliate B01BKYWN2C /?>





