---
Title: 秘密鍵を安全に管理するためにCryptomatorを使ってみた
Published: 2019/05/15 12:00:00
Tags:
  - "パソコン"
  - "備忘録"
Eyecatch: ""
---
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%C8%EB%CC%A9%B8%B0">秘密鍵</a>、どうやって管理してますか？</p>

<p>適当に.<a class="keyword" href="http://d.hatena.ne.jp/keyword/ssh">ssh</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リに入れたまま？<a class="keyword" href="http://d.hatena.ne.jp/keyword/USB%A5%E1%A5%E2%A5%EA">USBメモリ</a>ーなどに格納？はたまた<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AF%A5%E9%A5%A6%A5%C9">クラウド</a>ストレージに保管？</p>

<p>私はこれまで.<a class="keyword" href="http://d.hatena.ne.jp/keyword/ssh">ssh</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C7%A5%A3%A5%EC%A5%AF%A5%C8">ディレクト</a>リに突っ込むだけだったのですが、万が一ファイルが漏洩したり、ストレージが吹っ飛んだ時に困るので、もう少し安全な管理方法がないか考えたうえで、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Dropbox">Dropbox</a>上でCryptomatorを利用して暗号化することにしました。</p>

***

<h4>Cryptomatorとは</h4>

<p>Cryptomatorとは専用の仮想ドライブを作成し、その中に格納されたファイルを暗号化して保存する<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AA%A1%BC%A5%D7%A5%F3%A5%BD%A1%BC%A5%B9">オープンソース</a>のソフトウェアです。<br/>
(ただし、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%DE%A5%DB">スマホ</a>アプリは<a class="keyword" href="http://d.hatena.ne.jp/keyword/iOS">iOS</a>:1080円、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Android">Android</a>:1060円の買切有料)</p>

<p>作成した仮想ドライブは通常のストレージと同じくドライブ文字が指定され、ファイルやフォルダを保存します。内部的にはメ<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E2%A5%EA%A1%BC">モリー</a>上でファイルを復号して、<a class="keyword" href="http://d.hatena.ne.jp/keyword/WebDAV">WebDAV</a>（またはDokany）経由でアクセスしているそうです。</p>

<p>この仮想ドライブに保存されたファイル、フォルダは暗号化されたうえで、あらかじめ指定したフォルダ(以下金庫と呼称)に保存されます。</p>

<p>フォルダを丸ごと一つのファイルとして暗号化するわけでなく、それぞれ暗号化するので、オンラインストレージとの相性が良いのが特徴。<br/>
また、ファイル名も暗号化されるので、ファイル名から中身を特定されないのもよさみ。</p>

<p>オンラインストレージにフォルダを作成、指定することで、ファイルを安全に管理することができます。</p>

<h4>ダウンロード、インストール</h4>

<p>公式サイトから<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%B9%A5%C8%A1%BC%A5%E9">インストーラ</a>をダウンロード<br/>
<iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fcryptomator.org%2Fdownloads%2F%23winDownload" title="Cryptomator - Free Cloud Encryption" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515000250.png" alt="f:id:Ovis:20190515000250p:plain" title="f:id:Ovis:20190515000250p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%B9%A5%C8%A1%BC%A5%E9">インストーラ</a>を起動し、ライセンスを受諾。  <br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515000625.png" alt="f:id:Ovis:20190515000625p:plain" title="f:id:Ovis:20190515000625p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>インストール先を指定。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515000817.png" alt="f:id:Ovis:20190515000817p:plain" title="f:id:Ovis:20190515000817p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Dokan">Dokan</a> File System Driverは下記の<a class="keyword" href="http://d.hatena.ne.jp/keyword/WikiPedia">WikiPedia</a>の記事を参照。入れない場合は<a class="keyword" href="http://d.hatena.ne.jp/keyword/WebDAV">WebDAV</a>接続になります。入れておくべき。</p>

<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fja.wikipedia.org%2Fwiki%2FDokan" title="Dokan - Wikipedia" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515000727.png" alt="f:id:Ovis:20190515000727p:plain" title="f:id:Ovis:20190515000727p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>インストール中、上記でチェックを入れていたら<a class="keyword" href="http://d.hatena.ne.jp/keyword/Dokan">Dokan</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A4%A5%F3%A5%B9%A5%C8%A1%BC%A5%E9">インストーラ</a>ーが起動するので、こちらも同様にインストール。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515001107.png" alt="f:id:Ovis:20190515001107p:plain" title="f:id:Ovis:20190515001107p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>インストール完了。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515001143.png" alt="f:id:Ovis:20190515001143p:plain" title="f:id:Ovis:20190515001143p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h4>起動</h4>

<p>初回起動時は<a class="keyword" href="http://d.hatena.ne.jp/keyword/Windows">Windows</a>ファイアーウォールが警告を出すのでアクセス許可を出しておいてください。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515001231.png" alt="f:id:Ovis:20190515001231p:plain" title="f:id:Ovis:20190515001231p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>アップデート確認はお好きなように。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515001314.png" alt="f:id:Ovis:20190515001314p:plain" title="f:id:Ovis:20190515001314p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>メイン画面。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515001336.png" alt="f:id:Ovis:20190515001336p:plain" title="f:id:Ovis:20190515001336p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h4>仮想ドライブの作成</h4>

<p>メイン画面左下のプラスボタンをクリックするとメニューが表示されるので、「新しい金庫を作成」をクリック。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515001438.png" alt="f:id:Ovis:20190515001438p:plain" title="f:id:Ovis:20190515001438p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>名前を付けて保存のウィンドウが表示されるので、配置したいフォルダを開いたうえで、ファイル名欄に作成するフォルダ名を入力して保存ボタンをクリック。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515001950.png" alt="f:id:Ovis:20190515001950p:plain" title="f:id:Ovis:20190515001950p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>パスワードを設定して、金庫を作成ボタンをクリック。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515002041.png" alt="f:id:Ovis:20190515002041p:plain" title="f:id:Ovis:20190515002041p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>これで完了。<br/>
オプションからドライブ名やドライブ文字を変更可能。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515002150.png" alt="f:id:Ovis:20190515002150p:plain" title="f:id:Ovis:20190515002150p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>パスワード欄にパスワードを入力して、金庫を解錠ボタンをクリックすると、フォルダが復号されたうえで仮想ドライブとしてマウントされます。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515002430.png" alt="f:id:Ovis:20190515002430p:plain" title="f:id:Ovis:20190515002430p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>金庫を施錠ボタンを押すとアンマウントされます。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515002608.png" alt="f:id:Ovis:20190515002608p:plain" title="f:id:Ovis:20190515002608p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>こうやって仮想ドライブに保存された<a class="keyword" href="http://d.hatena.ne.jp/keyword/%C8%EB%CC%A9%B8%B0">秘密鍵</a>が<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515003203.png" alt="f:id:Ovis:20190515003203p:plain" title="f:id:Ovis:20190515003203p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>暗号化されたファイルはこのような感じで格納されてます。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515002754.png" alt="f:id:Ovis:20190515002754p:plain" title="f:id:Ovis:20190515002754p:plain" class="hatena-fotolife" itemprop="image"></span><br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515002817.png" alt="f:id:Ovis:20190515002817p:plain" title="f:id:Ovis:20190515002817p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>元のファイルに対して<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515003326.png" alt="f:id:Ovis:20190515003326p:plain" title="f:id:Ovis:20190515003326p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>こんな感じで中身がちゃんと暗号化されてます。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515003405.png" alt="f:id:Ovis:20190515003405p:plain" title="f:id:Ovis:20190515003405p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h4>別のマシンから開く</h4>

<p>メイン画面左下のプラスボタンのメニューにある「既存の金庫を開く」を選択し、
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515001438.png" alt="f:id:Ovis:20190515001438p:plain" title="f:id:Ovis:20190515001438p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>開きたい金庫にある 「masterkey.cryptomator」ファイルを選択して開くボタンをクリック。
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515003927.png" alt="f:id:Ovis:20190515003927p:plain" title="f:id:Ovis:20190515003927p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h4>金庫の削除</h4>

<p>単にCryptomatorから削除しようとしても、リストから消えるだけで、ファイル自体は消えません。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20190515003709.png" alt="f:id:Ovis:20190515003709p:plain" title="f:id:Ovis:20190515003709p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A8%A5%AF%A5%B9%A5%D7%A5%ED%A1%BC%A5%E9">エクスプローラ</a>で作成したフォルダごと削除すればOKです。</p>

<h4>おわり</h4>

<p>必要な時にだけ復号することで、オンラインストレージのバックアップ、共有を利用しつつ、安全にファイルを共有することができました。<br/>
AES-256bit暗号化方式で暗号化されているので、万が一暗号化されたファイルが流出しても今の技術レベルであれば安易に復元することは不可能なはず。</p>

<p>ドライブ文字の指定ができるので、.<a class="keyword" href="http://d.hatena.ne.jp/keyword/ssh">ssh</a>/configにIdentityFileでフルパス指定しておけば、Cryptomatorを起動してパスワード入力して解錠するだけですぐ使えます。<br/>
<iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fqiita.com%2F0084ken%2Fitems%2F2e4e9ae44ec5e01328f1" title=".ssh/configファイルでSSH接続を管理する - Qiita" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe>
手間というほど手間もないので、マ<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%BF%A1%BC%A5%D1%A5%B9">スターパス</a>ワードさえ忘れなければ(1Passwordなどのソフトで管理しましょう)手軽に使うことができるかと。便利なもんだ。</p>
