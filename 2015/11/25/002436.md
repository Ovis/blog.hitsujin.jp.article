---
Title: RDM接続していたディスクの中身が見えなくなって復旧させた話
Published: 2015/11/25 0:24:36
Tags:
  - "備忘録"
  - "パソコン"
Eyecatch: "20150423005741.png"
---
<p>4月ごろに書いておいて下書き状態で残ってたのを掘り起こし・・・。</p>

<p>自宅で利用している録画サーバーはESXi上の<a class="keyword" href="http://d.hatena.ne.jp/keyword/VM">VM</a>で動いてまして、録画ファイルを保存するためにHDDを<a class="keyword" href="http://d.hatena.ne.jp/keyword/RDM">RDM</a>で接続しています。<br/>
ここ最近その<a class="keyword" href="http://d.hatena.ne.jp/keyword/VM">VM</a>が不調でフリーズしがちだったので、そろそろ<a class="keyword" href="http://d.hatena.ne.jp/keyword/Windows%207">Windows 7</a>な録画<a class="keyword" href="http://d.hatena.ne.jp/keyword/VM">VM</a>を廃止して、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Windows%208">Windows 8</a>で環境を作り直そうと画策したのですが、新たに<a class="keyword" href="http://d.hatena.ne.jp/keyword/VM">VM</a>を作ってそちらから<a class="keyword" href="http://d.hatena.ne.jp/keyword/RDM">RDM</a>接続したHDDに接続したところ、
<span itemscope itemtype="http://schema.org/Photograph"><img src="20150423005741.png" alt="f:id:Ovis:20150423005741p:plain" title="f:id:Ovis:20150423005741p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>こんな風にまだフォーマットしていないHDDとして認識されてしまい、中に入っていたデータが読み込めなくなる事態が発生・・・。</p>

<p>これまで録画していた番組や音楽ファイルが入っていたのでこれが消えたら大惨事。<br/>
とりあえず事態をまとめると</p>

<ul>
<li>3TBのHDDと4TBのHDDで現象発生</li>
<li>2TBのHDDでは現象発生せず</li>
<li>行った操作は<a class="keyword" href="http://d.hatena.ne.jp/keyword/RDM">RDM</a>接続をするために作成したファイルを<a class="keyword" href="http://d.hatena.ne.jp/keyword/VM">VM</a>に紐づかせただけ</li>
</ul>


<p>そもそもESXiでの<a class="keyword" href="http://d.hatena.ne.jp/keyword/RDM">RDM</a>接続は、2TB以上では<a class="keyword" href="http://d.hatena.ne.jp/keyword/Windows">Windows</a>がうまく認識してくれず、GPartedでフォーマットする必要があったなど若干リスキーなことをしていたので、<a class="keyword" href="http://d.hatena.ne.jp/keyword/VM">VM</a>を切り替えたことでまた何か踏み抜いた模様。<br/>
<a href="https://communities.vmware.com/message/2487522">こちらの記事</a>によるとESXi 6.0で問題が解消している模様とのことだったので6.0にアップグレードしてみたのですが結果は変わらず。</p>

<p>ほかの<a class="keyword" href="http://d.hatena.ne.jp/keyword/Windows">Windows</a>機に直接接続してもやはりNTFSフォーマットされたドライブとして認識してくれず困り果てていたのですが、ふと思い返してみると<a class="keyword" href="http://d.hatena.ne.jp/keyword/RDM">RDM</a>接続なら直接ファイルをHDDに保存しているわけで、ファイルが消えるような処理は何もしていない。<br/>
となるともしかしたら<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%C6%A5%A3%A5%B7%A5%E7%A5%F3">パーティション</a>テーブルが壊れて認識できなくなっただけなんじゃないかという気がしてきました。</p>

<p>で、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%C6%A5%A3%A5%B7%A5%E7%A5%F3">パーティション</a>テーブルが壊れたときに使われる<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C4%A1%BC%A5%EB">ツール</a>として有名どころを探したところ「TestDisk」というソフトを発見。</p>

<p><iframe src="//hatenablog-parts.com/embed?url=http%3A%2F%2Fwww.cgsecurity.org%2Fwiki%2FTestDisk" title="TestDisk - Partition Recovery and File Undelete" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="http://www.cgsecurity.org/wiki/TestDisk">www.cgsecurity.org</a></cite></p>

<h5>TestDiskを起動</h5>

<p>TestDiskを起動するとこの画面になるのでログファイルの作成方法を選択。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20151125000656.png" alt="f:id:Ovis:20151125000656p:plain" title="f:id:Ovis:20151125000656p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h5>HDDの選択</h5>

<p>中身が見えなくなってしまったHDDを選択。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20151125000859.png" alt="f:id:Ovis:20151125000859p:plain" title="f:id:Ovis:20151125000859p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h5><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%C6%A5%A3%A5%B7%A5%E7%A5%F3">パーティション</a>テーブルの選択</h5>

<p>私は確か<a class="keyword" href="http://d.hatena.ne.jp/keyword/EFI">EFI</a> GPTを選んだと思うんですが(うろ覚え)、たぶん<a class="keyword" href="http://d.hatena.ne.jp/keyword/Intel">Intel</a>選んでおけばよさそう。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20151125000940.png" alt="f:id:Ovis:20151125000940p:plain" title="f:id:Ovis:20151125000940p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h5><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%C6%A5%A3%A5%B7%A5%E7%A5%F3">パーティション</a>チェック</h5>

<p>選択したHDDの中身をチェック。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20151125001227.png" alt="f:id:Ovis:20151125001227p:plain" title="f:id:Ovis:20151125001227p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h5>検索</h5>

<p>Quick Searchを選択。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20151125001350.png" alt="f:id:Ovis:20151125001350p:plain" title="f:id:Ovis:20151125001350p:plain" class="hatena-fotolife" itemprop="image"></span><br/>
検索中。。。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20151125001415.png" alt="f:id:Ovis:20151125001415p:plain" title="f:id:Ovis:20151125001415p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h5><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%C6%A5%A3%A5%B7%A5%E7%A5%F3">パーティション</a>情報</h5>

<p>検索した結果情報が取得できた！ファイルリストが確認できるようになってます。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20151125001612.png" alt="f:id:Ovis:20151125001612p:plain" title="f:id:Ovis:20151125001612p:plain" class="hatena-fotolife" itemprop="image"></span><br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20151125001540.png" alt="f:id:Ovis:20151125001540p:plain" title="f:id:Ovis:20151125001540p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h5><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%C6%A5%A3%A5%B7%A5%E7%A5%F3">パーティション</a>情報書き込み</h5>

<p>Enterを押すと以下の画面になるので、Writeを選択。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20151125001817.png" alt="f:id:Ovis:20151125001817p:plain" title="f:id:Ovis:20151125001817p:plain" class="hatena-fotolife" itemprop="image"></span><br/>
本当にいいんか？と聞かれるのでYを押してEnter。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20151125001908.png" alt="f:id:Ovis:20151125001908p:plain" title="f:id:Ovis:20151125001908p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>書き込みが終わったらPCを再起動。<br/>
<span itemscope itemtype="http://schema.org/Photograph"><img src="20151125002029.png" alt="f:id:Ovis:20151125002029p:plain" title="f:id:Ovis:20151125002029p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<h5>復活！</h5>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="20151125002139.png" alt="f:id:Ovis:20151125002139p:plain" title="f:id:Ovis:20151125002139p:plain" class="hatena-fotolife" itemprop="image"></span></p>

<p>というわけで無事大切なファイルたちを救い出すことができました。<br/>
私の場合はMFTか何かが壊れただけでファイルそのものは無事だったわけですが、さらに重症であったときもこのソフトは役に立つみたいです。</p>

<p><a href="http://akanoren.blog136.fc2.com/blog-entry-118.html">&#x5F92;&#x7136;&#x8D64;&#x306E;&#x308C;&#x3093; RAW&#x30D1;&#x30FC;&#x30C6;&#x30A3;&#x30FC;&#x30B7;&#x30E7;&#x30F3;&#x3068;&#x306A;&#x3063;&#x305F;3TB&#x306E;HDD&#x304B;&#x3089;testdisk&#x3067;&#x30C7;&#x30FC;&#x30BF;&#x62BD;&#x51FA; &#x9577;&#x6587;</a></p>

***