---
Title: NuGetパッケージの名前空間コンフリクト対策でextern aliasを利用する
Published: 2021/05/24 21:00:00
Tags:
  - "ASP.NET"
  - "プログラミング"
  - "備忘録"
Eyecatch: "20210524121125.png"
---
<p>業務アプリで利用しているSDKを更新していてはまったので覚書。</p>

<h4>問題</h4>

<p>今回 <code>Microsoft.Azure.Cosmos</code> と <code>Microsoft.Azure.Cosmos.Table</code> をそれぞれ用いる構成なのですが、単純にNuGetパッケージをインストールすると、名前空間が衝突する箇所があり、</p>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="20210524121125.png" alt="f:id:Ovis:20210524121125p:plain" title="" class="hatena-fotolife" itemprop="image"></span></p>

<blockquote><p>エラー CS0433  型 'IndexingMode' が 'Microsoft.Azure.Cosmos.Client, Version=3.18.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35' と 'Microsoft.Azure.Cosmos.Table, Version=1.0.8.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35' の両方に存在します</p></blockquote>

<p>このようにエラーとなります。</p>

<h4>解決策</h4>

<p>.NETではこのように名前空間が衝突してしまう場合に、 externエイリアスという機能を利用して解決することができます。</p>

<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fdocs.microsoft.com%2Fja-jp%2Fdotnet%2Fcsharp%2Flanguage-reference%2Fkeywords%2Fextern-alias" title="extern エイリアス - C# リファレンス" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe></p>

<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Frksoftware.hatenablog.com%2Fentry%2F2021%2F01%2F28%2F194508" title="C＃ 2.0 以降の新機能の確認 - C# 2.0 - extern エイリアス - rksoftware" class="embed-card embed-blogcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 190px; max-width: 500px; margin: 10px 0px;"></iframe></p>

<p>DLLファイルだったら各DLLのプロパティでエイリアスを指定するらしいのですが、NuGetパッケージの場合はそういうことはできません。</p>

<p>この場合、csprojファイルに下記のように記載することで対応できます。</p>

<pre class="code" data-lang="" data-unlink> &lt;Target Name=&#34;ChangeAliasesOfAzureTables&#34; BeforeTargets=&#34;FindReferenceAssembliesForReferences;ResolveReferences&#34;&gt;
&lt;ItemGroup&gt;
&lt;ReferencePath Condition=&#34;&#39;%(FileName)&#39; == &#39;Microsoft.Azure.Cosmos.Table(エイリアス指定したいNuGetパッケージ名)&#39;&#34;&gt;
&lt;Aliases&gt;AzureTable(エイリアス名)&lt;/Aliases&gt;
&lt;/ReferencePath&gt;
&lt;/ItemGroup&gt;
&lt;/Target&gt;</pre>


<p>あとは通常通り、</p>

<pre class="code" data-lang="" data-unlink>extern alias AzureTable;
using AzureTable::Microsoft.Azure.Cosmos.Table;</pre>


<p>こんな感じでusingを記載してやれば、うまく回避することができます。</p>

<h4>参考</h4>

<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F33460667%2Fhow-to-use-extern-alias-with-nuget" title="How to use extern alias with nuget" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe></p>

***