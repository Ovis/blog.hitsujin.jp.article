---
Title: Azure Functions v3でCosmosDBの基本処理を実行するためのサンプルプロジェクト
Published: 2020/04/05 23:00:00
Tags:
  - "Microsoft"
  - "プログラミング"
  - "VPS、クラウド"
Eyecatch: ""
---
<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fgithub.com%2FOvis%2FAzureFunctionsCosmosDBSample" title="Ovis/AzureFunctionsCosmosDBSample" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe></p>

<p>せっかくAzureでCosmosDBの無料枠ができたので、使わない手はないなと思って基本的な挙動確認用のプロジェクトを作成してみました。</p>

<p>CosmosDBのデータベース、コンテナ作成から登録更新検索削除の一通りの基本処理をAzure Functionsのv3環境で実装しています。</p>

<p>学習がてらDI実装。Azure CosmosDB Emulator をインストールすればローカル実行可能です(というよりはまだAzure上で確認してない)。</p>

<p>あくまでサンプルなので異常系の対応とかは特に入ってません。</p>

<h4>余談</h4>

<p>当初せっかくv3環境なのでNewtonsoft.<a class="keyword" href="http://d.hatena.ne.jp/keyword/Json">Json</a>を用いず、System.Text.<a class="keyword" href="http://d.hatena.ne.jp/keyword/Json">Json</a>を利用しようと考えていたのですが、うまくいかず断念しました。<br />
プロパティ名は頭を大文字にするため、Newtonsoft.<a class="keyword" href="http://d.hatena.ne.jp/keyword/Json">Json</a>だと <code>JsonProperty</code> を用いて別名を指定するわけですが、同じ挙動をするはずのSystem.Text.<a class="keyword" href="http://d.hatena.ne.jp/keyword/Json">Json</a>の  <code>JsonPropertyName</code> だと</p>

<blockquote><p>The input content is invalid because the required properties - 'id; ' - are missing</p></blockquote>

<p>というエラーが出てしまい実行に失敗してしまいます。<br />
どうもCosmosDBのv3SDKはまだNewtonSoft.<a class="keyword" href="http://d.hatena.ne.jp/keyword/Json">Json</a>にがっつり依存しているため、System.Text.<a class="keyword" href="http://d.hatena.ne.jp/keyword/Json">Json</a>を使いたいならv4までまて、ということのようです。</p>

<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fgithub.com%2FAzure%2Fazure-cosmos-dotnet-v3%2Fissues%2F951" title="Renaming Document Id property in .NET Core 3.0 requires Newtonsoft.Json · Issue #951 · Azure/azure-cosmos-dotnet-v3" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe></p>

<h4>余談の追記</h4>

<p>Version 3.1.2から<code>SerializerOptions</code>でcamelCase指定ができるようになってたようです。<br />
これを設定しておけばそもそもJsonPropertyの指定も不要ですね。</p>

<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fgithub.com%2FAzure%2Fazure-cosmos-dotnet-v3%2Fpull%2F716%2F" title="Adding camel case serialization on LINQ query generation by simplynaveen20 · Pull Request #716 · Azure/azure-cosmos-dotnet-v3" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe></p>

<h4>参考サイト</h4>

<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fblog.shibayan.jp%2Fentry%2F20190713%2F1562955405" title="Azure Cosmos DB .NET SDK v3 GA 記念チートシート - しばやん雑記" class="embed-card embed-blogcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 190px; max-width: 500px; margin: 10px 0px;"></iframe></p>

<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fqiita.com%2FHiroyukiSakoh%2Fitems%2Fe9e472a92a53da4d7568" title="Azure Function v2のDIサンプル - Qiita" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe></p>

<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fsqlazure.jp%2Fb%2Fcosmosdb%2F2894%2F" title="Microsoft Azure Cosmos DB .NET SDK Version 3 のクライアントオプション | 蒼の王座" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe></p>

***