---
Title: rsyncとSCPについて調べてみた
Published: 2011/11/14 16:11:59
Tags:
  - "備忘録"
Eyecatch: "http://pandora.thty.net/wp-content/uploads/2011/11/ssh.jpg"
---
<p><span><img class="hatena-fotolife" title="f:id:Ovis:20140126011055j:plain" src="20140126011055.jpg" alt="f:id:Ovis:20140126011055j:plain" /></span></p>
<p> </p>
<p>運営しているサイトのサーバー環境をリフレッシュさせたくて一時的にサブ<a class="keyword" href="http://d.hatena.ne.jp/keyword/VPS">VPS</a>に移動して作業していたときにふと<a class="keyword" href="http://d.hatena.ne.jp/keyword/rsync">rsync</a>とSCPの違いが気になったので調べてみました。</p>
<p> </p>
***



<p> </p>
<p> </p>
<p> </p>
<p>まず<a class="keyword" href="http://d.hatena.ne.jp/keyword/rsync">rsync</a>とはコピー元ディレクトリとコピー先ディレクトリを同期させる<a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a>コマンドのこと。ローカルだけではなく別のサーバーにも同期可能。</p>
<p>それに対しSCPは<a class="keyword" href="http://d.hatena.ne.jp/keyword/SSH">SSH</a>を利用したファイル転送コマンドのこと。<a class="keyword" href="http://d.hatena.ne.jp/keyword/rsync">rsync</a>も<a class="keyword" href="http://d.hatena.ne.jp/keyword/SSH">SSH</a>を利用して暗号化しつつデータを転送でき、どちらかというと<a class="keyword" href="http://d.hatena.ne.jp/keyword/rsync">rsync</a>のほうが高性能。</p>
<p> </p>
<p>また、SCPは転送先に同名ファイルがあるとそのファイルをオープンして転送するため、転送中にアクセスされると中途半端な内容が読み込まれてしまったり、転送を中断した場合転送先のファイルが破損する可能性があるとか。</p>
<p>それに対して<a class="keyword" href="http://d.hatena.ne.jp/keyword/rsync">rsync</a>は転送が終了してからファイルを削除するのでたとえアクセスがあったとしても問題なし。また転送を中断してもまず一時ファイルとしてデータを書き出すのでファイルが破損する可能性もない。</p>
<p> </p>
<p>というわけで重要なファイルを転送したりするときは<a class="keyword" href="http://d.hatena.ne.jp/keyword/rsync">rsync</a>を使うのがよさそう。そうでないときはコマンドが単純でCPUパワーをそこまで食わないSCPでさくっと。（<a class="keyword" href="http://d.hatena.ne.jp/keyword/rsync">rsync</a>は差分の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C1%A5%A7%A5%C3%A5%AF%A5%B5%A5%E0">チェックサム</a>をとる関係でCPUパワーが必要）</p>
<p> </p>
<p>以下両コマンドの使い方備忘録</p>
<p> </p>
<p>・SCP</p>
<p> </p>
<p>scp オプション ファイル（ディレクトリ）名 ユーザ名@転送先IPor<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C9%A5%E1%A5%A4%A5%F3">ドメイン</a>:転送先パス （パス省略時ユーザホームディレクトリ）</p>
<p> </p>
<p>ex) scp hogehoge,tgz <a class="keyword" href="http://d.hatena.ne.jp/keyword/hoge">hoge</a>@<a class="keyword" href="http://d.hatena.ne.jp/keyword/hoge">hoge</a>.net:/home/<a class="keyword" href="http://d.hatena.ne.jp/keyword/hoge">hoge</a>/</p>
<p> </p>
<p>コマンドオプション</p>
<p> </p>
<p>・-r ディレクトリごと転送 scp /<a class="keyword" href="http://d.hatena.ne.jp/keyword/hoge">hoge</a> の場合<a class="keyword" href="http://d.hatena.ne.jp/keyword/hoge">hoge</a>ディレクトリが転送</p>
<p>・-P ポート指定</p>
<p>・-p 最終修正時刻、最終アクセス時刻、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%DF%A5%C3%A5%B7%A5%E7%A5%F3">パーミッション</a>を引き継ぐ</p>
<p>・-C 圧縮転送</p>
<p>・-c 暗号形式の指定</p>
<p>・-i 公開鍵のパス指定</p>
<p>・-l 転送速度指定</p>
<p>・-q 進行状況等非表示</p>
<p> </p>
<p>・<a class="keyword" href="http://d.hatena.ne.jp/keyword/rsync">rsync</a></p>
<p> </p>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/rsync">rsync</a> オプション ファイル（ディレクトリ）名  ユーザ名@転送先IPor<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C9%A5%E1%A5%A4%A5%F3">ドメイン</a>:</p>
<p> </p>
<p>ex) <a class="keyword" href="http://d.hatena.ne.jp/keyword/rsync">rsync</a> –avz –delete</p>
<p> </p>
<p>コマンドオプション</p>
<p>・-a 元の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%DF%A5%C3%A5%B7%A5%E7%A5%F3">パーミッション</a>やグループなどを保持したまま同期。-rlptgoDしたのと同じことになる。</p>
<p>・-D 特殊なファイルもそのまま同期</p>
<p>・-g グループ情報を維持して同期</p>
<p>・-l <a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B7%A5%F3%A5%DC%A5%EA%A5%C3%A5%AF%A5%EA%A5%F3%A5%AF">シンボリックリンク</a>をそのままコピー</p>
<p>・-n 実際には同期せず実行時の動作のみ出力（--dry-run）</p>
<p>・-o 所有者情報を保持したまま同期</p>
<p>・-p <a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%DF%A5%C3%A5%B7%A5%E7%A5%F3">パーミッション</a>を保持したまま同期</p>
<p>・-q 情報非表示</p>
<p>・-r 指定したディレクトリ以下のディレクトリも<a class="keyword" href="http://d.hatena.ne.jp/keyword/%BA%C6%B5%A2">再帰</a>的にバックアップ</p>
<p>・-t タイムスタンプを保持したままコピー</p>
<p>・-u 追加、更新されたファイルだけコピー</p>
<p>・-v 処理中の経過ファイル名を表示</p>
<p>・-z 圧縮転送</p>
<p>・—delete 動機元にないファイルが同期先にあった場合ファイルを削除</p>
<p>・--exclude=○○ 指定したパターンに一致したファイルを同期対象から排除</p>
<p>・--existing 転送先にないファイルは同期しない</p>
<p>・—ignore-existing 転送先に存在するファイルは同期しない</p>
<p> </p>
<p>なお、転送元のディレクトリ名に/をつけるかどうかで挙動が変わる点に注意。</p>
<p>つけないとディレクトリそのものがコピーされ、つけているとコピーされない。</p>
<p> </p>
<p>また、昔は-e <a class="keyword" href="http://d.hatena.ne.jp/keyword/SSH">SSH</a> として明示的に<a class="keyword" href="http://d.hatena.ne.jp/keyword/SSH">SSH</a>を利用することを宣言しなければならなかったみたいですけど最近は<a class="keyword" href="http://d.hatena.ne.jp/keyword/SSH">SSH</a>を利用するのがデフォルトになったようですね。</p>
<p> </p>
<p>参考URL</p>
<p>・<a class="keyword" href="http://d.hatena.ne.jp/keyword/UNIX">UNIX</a>の部屋 コマンド検索:<a class="keyword" href="http://d.hatena.ne.jp/keyword/rsync">rsync</a> (*<a class="keyword" href="http://d.hatena.ne.jp/keyword/BSD">BSD</a>/<a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a>)</p>
<p><a href="http://x68000.q-e-d.net/~68user/unix/pickup?rsync">http://x68000.q-e-d.net/~68user/unix/pickup?rsync</a></p>
<p>・Command Technica：はじめて<a class="keyword" href="http://d.hatena.ne.jp/keyword/rsync">rsync</a>を使う方が知っておきたい6つのルール - <a class="keyword" href="http://d.hatena.ne.jp/keyword/ITmedia">ITmedia</a> <a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A8%A5%F3%A5%BF%A1%BC%A5%D7%A5%E9%A5%A4%A5%BA">エンタープライズ</a></p>
<p><a href="http://www.itmedia.co.jp/enterprise/articles/0804/21/news013.html">http://www.itmedia.co.jp/enterprise/articles/0804/21/news013.html</a></p>
<p>・<a class="keyword" href="http://d.hatena.ne.jp/keyword/rsync">rsync</a>コマンド - 管理者必見！ ネットワーク・コマンド集：ITpro</p>
<p><a href="http://itpro.nikkeibp.co.jp/article/COLUMN/20070822/280151/">http://itpro.nikkeibp.co.jp/article/COLUMN/20070822/280151/</a></p>
<p>・SCP (1)</p>
<p><a href="http://www.unixuser.org/~euske/doc/openssh/jman/scp.html">http://www.unixuser.org/~euske/doc/openssh/jman/scp.html</a></p>