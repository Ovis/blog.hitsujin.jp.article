---
Title: RDM接続していたディスクの中身が見えなくなって復旧させた話
Published: 2015/11/25 0:24:36
Tags:
  - "備忘録"
  - "パソコン"
Eyecatch: "20150423005741.png"
---
4月ごろに書いておいて下書き状態で残ってたのを掘り起こし・・・。  

自宅で利用している録画サーバーはESXi上のVMで動いてまして、録画ファイルを保存するためにHDDをRDMで接続しています。  
ここ最近そのVMが不調でフリーズしがちだったので、そろそろWindows 7な録画VMを廃止して、Windows 8で環境を作り直そうと画策したのですが、新たにVMを作ってそちらからRDM接続したHDDに接続したところ、
![](20150423005741.png) 

こんな風にまだフォーマットしていないHDDとして認識されてしまい、中に入っていたデータが読み込めなくなる事態が発生・・・。  

これまで録画していた番組や音楽ファイルが入っていたのでこれが消えたら大惨事。  
とりあえず事態をまとめると 

* 3TBのHDDと4TBのHDDで現象発生
* 2TBのHDDでは現象発生せず
* 行った操作はRDM接続をするために作成したファイルをVMに紐づかせただけ

そもそもESXiでのRDM接続は、2TB以上ではWindowsがうまく認識してくれず、GPartedでフォーマットする必要があったなど若干リスキーなことをしていたので、VMを切り替えたことでまた何か踏み抜いた模様。  
[こちらの記事](https://communities.vmware.com/message/2487522)によるとESXi 6.0で問題が解消している模様とのことだったので6.0にアップグレードしてみたのですが結果は変わらず。  

ほかのWindows機に直接接続してもやはりNTFSフォーマットされたドライブとして認識してくれず困り果てていたのですが、ふと思い返してみるとRDM接続なら直接ファイルをHDDに保存しているわけで、ファイルが消えるような処理は何もしていない。  
となるともしかしたらパーティションテーブルが壊れて認識できなくなっただけなんじゃないかという気がしてきました。  

で、パーティションテーブルが壊れたときに使われるツールとして有名どころを探したところ「TestDisk」というソフトを発見。  


<?# OEmbed "http://www.cgsecurity.org/wiki/TestDisk" /?>


##### TestDiskを起動
TestDiskを起動するとこの画面になるのでログファイルの作成方法を選択。  
![](20151125000656.png)   


##### HDDの選択  
中身が見えなくなってしまったHDDを選択。  
![](20151125000859.png)   

##### パーティションテーブルの選択  
私は確かEFI GPTを選んだと思うんですが(うろ覚え)、たぶんIntel選んでおけばよさそう。  
![](20151125000940.png)   

##### パーティションチェック  
選択したHDDの中身をチェック。  
![](20151125001227.png)   

##### 検索  
Quick Searchを選択。  
![](20151125001350.png)   
検索中。。。  
![](20151125001415.png)   

##### パーティション情報  
検索した結果情報が取得できた！ファイルリストが確認できるようになってます。  
![](20151125001612.png)   
![](20151125001540.png) 

##### パーティション情報書き込み  
Enterを押すと以下の画面になるので、Writeを選択。  
![](20151125001817.png)   
本当にいいんか？と聞かれるのでYを押してEnter。  
![](20151125001908.png)   

書き込みが終わったらPCを再起動。  
![](20151125002029.png)   

##### 復活！
![](20151125002139.png)   

というわけで無事大切なファイルたちを救い出すことができました。  
私の場合はMFTか何かが壊れただけでファイルそのものは無事だったわけですが、さらに重症であったときもこのソフトは役に立つみたいです。  

<?# OEmbed "http://akanoren.blog136.fc2.com/blog-entry-118.html" /?>

