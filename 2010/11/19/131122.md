---
Title: VPSでUbuntuサーバー 未完成備忘録 其の五 -その他細々とした設定等々-
Published: 2010/11/19 13:11:22
Tags:
  - "備忘録"
Eyecatch: "http://pandora.thty.net/wp-content/uploads/2010/07/vps.jpg"
---
<p><span><img class="hatena-fotolife" title="f:id:Ovis:20061014153348j:plain" src="20061014153348.jpg" alt="f:id:Ovis:20061014153348j:plain" width="351" height="253" /></span></p>
<p> </p>
<p style="text-align: left;">これまでの設定でＨＴＭＬファイルの表示からＣＧＩの実行、セキュリティ設定も一通りできたはず、多分。</p>
<p>ついでなので書き忘れていたことも含めちょっとだけ追加。</p>
<p> </p>
<p style="text-align: left;"> </p>
<p> </p>
***



<p> </p>
<p style="text-align: left;">今回のサーバー構築では、一つのユーザーごとに/home/ユーザー名というディレクトリにpulic_htmlディレクトリを作成してその中にブラウザで表示するファイルを入れることにしている。</p>
<p>ただ、いちいちユーザーを作るたびにpublic_htmlディレクトリを作るのは面倒なのであらかじめユーザー作成時に作成されるようにする。</p>
<p> </p>
<pre style="text-align: left;">mkdir /etc/skel/public_html/</pre>
<p>mkdir /etc/skel/log/</p>
<p>mkdir /etc/skel/.<a class="keyword" href="http://d.hatena.ne.jp/keyword/ssh">ssh</a>/</p>
<p>chmod 700 /etc/skel/.<a class="keyword" href="http://d.hatena.ne.jp/keyword/ssh">ssh</a>/</p>
<p> </p>
<p> </p>
<p style="text-align: left;">続いて時間あわせ。</p>
<p>よっぽどそんな簡単に時間が狂うことはないだろうけど、ファイルスタンプが実際と違うのは困るので設定をしておく。</p>
<p>なお、NTPデーモンを起動させておくとメモリーがもったいない気がするのでntpdateでやってしまう。</p>
<p>ただし、一部の環境では問題が起きることもあるらしいので注意。</p>
<p> </p>
<pre style="text-align: left;">root環境下で</pre>
<p>crontab -e</p>
<p>39 5,18 * * * /usr/sbin/ntpdate 210.171.226.40</p>
<p>分 時 日 週 月 コマンドの順になっている。</p>
<p> </p>
<p style="text-align: left;"><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%ED%A5%B1%A1%BC%A5%EB">ロケール</a>の変更をしておく。</p>
<p>何で変更するのかはちょっと忘れてしまったけど（ｺﾗ</p>
<p> </p>
<p style="text-align: left;">vi /etc/locale.alias</p>
<p> </p>
<pre style="text-align: left;">ja_JP           ja_JP.eucJP</pre>
<p>↓</p>
<p>ja_JP ja_JP.<a class="keyword" href="http://d.hatena.ne.jp/keyword/UTF-8">UTF-8</a></p>
<p> </p>
<p> </p>
<p style="text-align: left;"> </p>
<p> </p>
<p style="text-align: left;">File does not exist: /home/*****/public_html/<a class="keyword" href="http://d.hatena.ne.jp/keyword/favicon">favicon</a>.<a class="keyword" href="http://d.hatena.ne.jp/keyword/ico">ico</a></p>
<p>なんていうエラーがログに書かれる場合は</p>
<p> </p>
<pre style="text-align: left;">SetEnvIf <a class="keyword" href="http://d.hatena.ne.jp/keyword/Request_URI">Request_URI</a> "^/<a class="keyword" href="http://d.hatena.ne.jp/keyword/favicon">favicon</a>.<a class="keyword" href="http://d.hatena.ne.jp/keyword/ico">ico</a>$" no_log</pre>
<p> </p>
<p> </p>
<p style="text-align: left;">とすることで回避できる。もちろんpublic_htmlディレクトリに<a class="keyword" href="http://d.hatena.ne.jp/keyword/favicon">favicon</a>.<a class="keyword" href="http://d.hatena.ne.jp/keyword/ico">ico</a>をおいておくのもあり。</p>
<p> </p>
<p style="text-align: left;"> </p>
<p> </p>
<p style="text-align: left;">サーバーの負荷対策にキャッシュを利用。</p>
<p>まずは画像のキャッシュから。</p>
<p> </p>
<pre style="text-align: left;">ExpiresActive On</pre>
<p>ExpiresByType image/<a class="keyword" href="http://d.hatena.ne.jp/keyword/gif">gif</a> "<a class="keyword" href="http://d.hatena.ne.jp/keyword/access">access</a> plus 15 minutes"</p>
<p>ExpiresByType image/<a class="keyword" href="http://d.hatena.ne.jp/keyword/jpeg">jpeg</a> "<a class="keyword" href="http://d.hatena.ne.jp/keyword/access">access</a> plus 15 minutes"</p>
<p>ExpiresByType image/<a class="keyword" href="http://d.hatena.ne.jp/keyword/png">png</a> "<a class="keyword" href="http://d.hatena.ne.jp/keyword/access">access</a> plus 15 minutes"</p>
<p>ExpiresByType application/x-<a class="keyword" href="http://d.hatena.ne.jp/keyword/shockwave">shockwave</a>-<a class="keyword" href="http://d.hatena.ne.jp/keyword/flash">flash</a> "<a class="keyword" href="http://d.hatena.ne.jp/keyword/access">access</a> plus 15 minutes"</p>
<p>ExpiresByType text/html "<a class="keyword" href="http://d.hatena.ne.jp/keyword/access">access</a> plus 5 minutes"</p>
<p>ExpiresByType text/<a class="keyword" href="http://d.hatena.ne.jp/keyword/css">css</a> "<a class="keyword" href="http://d.hatena.ne.jp/keyword/access">access</a> plus 15 minutes"</p>
<p> </p>
<p> </p>
<p style="text-align: left;">これはmod＿expiresを利用しているのであらかじめモジュールをロードしておくこと。</p>
<p> </p>
<p style="text-align: left;"> </p>
<p> </p>
<p style="text-align: left;">さらに<a class="keyword" href="http://d.hatena.ne.jp/keyword/PHP">PHP</a>のキャッシュも利用しておく。</p>
<p> </p>
<pre style="text-align: left;"><a class="keyword" href="http://d.hatena.ne.jp/keyword/aptitude">aptitude</a> install <a class="keyword" href="http://d.hatena.ne.jp/keyword/php">php</a>-<a class="keyword" href="http://d.hatena.ne.jp/keyword/apc">apc</a></pre>
<p> </p>
<p> </p>
<p style="text-align: left;">以下のファイルを変更することで使用メモリー量も削減できる。むろん削減するだけ効果は薄れるのでケースバイケースで。</p>
<p>/etc/php5/conf.d/<a class="keyword" href="http://d.hatena.ne.jp/keyword/apc">apc</a>.ini</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>パラメータ内容デフォルト値</p>
<p> </p>
<p> </p>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/apc">apc</a>.shm_size</p>
<p>共有メモリ容量(MB)</p>
<p>30</p>
<p> </p>
<p> </p>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/apc">apc</a>.numfiles_hint</p>
<p>キャッシュ対象のファイル総数</p>
<p>1000</p>
<p> </p>
<p> </p>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/apc">apc</a>.filters</p>
<p>キャッシュ対象外のルール(<a class="keyword" href="http://d.hatena.ne.jp/keyword/%C0%B5%B5%AC%C9%BD%B8%BD">正規表現</a>)</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p style="text-align: left;"> </p>
<p> </p>
<p style="text-align: left;"> </p>