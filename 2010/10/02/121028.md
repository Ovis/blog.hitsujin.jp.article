---
Title: VPSでUbuntuサーバー 未完成備忘録 其の四 -アンチウイルスソフトインストール-
Published: 2010/10/02 12:10:28
Tags:
  - "備忘録"
Eyecatch: "http://pandora.thty.net/wp-content/uploads/2010/07/vps.jpg"
---
<p><span><img class="hatena-fotolife" title="f:id:Ovis:20061014153348j:plain" src="20061014153348.jpg" alt="f:id:Ovis:20061014153348j:plain" width="330" height="238" /></span></p>
<p> </p>
<p style="text-align: left;">前回までの設定でWebサーバーとしての機能は大概そろったはず。</p>
<p>次はセキュリティ問題に。</p>
<p> </p>
<p style="text-align: left;"> </p>
<p> </p>
***



<p> </p>
<p style="text-align: left;">私のサイトは<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A2%A5%C3%A5%D7%A5%ED%A1%BC%A5%C0">アップローダ</a>もあるので万が一ウイルスに感染したファイルがアップロードされたときに備えて<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A2%A5%F3%A5%C1%A5%A6%A5%A4%A5%EB%A5%B9%A5%BD%A5%D5%A5%C8">アンチウイルスソフト</a>ウェアを導入。</p>
<p> </p>
<p style="text-align: left;">一般的に使われている<a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A2%A5%F3%A5%C1%A5%A6%A5%A4%A5%EB%A5%B9%A5%BD%A5%D5%A5%C8">アンチウイルスソフト</a>は<a class="keyword" href="http://d.hatena.ne.jp/keyword/ClamAV">ClamAV</a>。でも、少々メモリーを食らいすぎるのが玉に瑕。常駐しているのかな？</p>
<p>というわけでもう少し軽いソフトウェアをインストール。</p>
<p> </p>
<p style="text-align: left;">今回選んだのはF-Prot Antivirusというソフト。これも無料。</p>
<p> </p>
<p style="text-align: left;">まずはF-Prot Antivirus for <a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a>をDLする。</p>
<p>このソフトは解凍したフォルダを今後も利用するみたいなので（？）、あらかじめDL前に移動しておくなり、解凍先を指定しておいた方がいいかも。</p>
<p><a href="http://www.f-prot.com/download/home_user/download_fplinux.html" target="_blank">こちら</a>のサイトからDL。</p>
<p> </p>
<blockquote>
<p style="text-align: left;"><a class="keyword" href="http://d.hatena.ne.jp/keyword/wget">wget</a> <a href="http://files.f-prot.com/files/unix-trial/fp-Linux-i686-ws.tar.gz">http://files.f-prot.com/files/unix-trial/fp-Linux-i686-ws.tar.gz</a></p>
</blockquote>
<p> </p>
<p style="text-align: left;">DLしたら解凍。</p>
<p> </p>
<blockquote>
<p style="text-align: left;">tar xzvf fp-<a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a>-<a class="keyword" href="http://d.hatena.ne.jp/keyword/i686">i686</a>-ws.tar.gz</p>
</blockquote>
<p> </p>
<p style="text-align: left;">解凍が終わったら解凍されてできたフォルダに移動し、インストールファイルを実行。</p>
<p> </p>
<blockquote>
<p style="text-align: left;">cd ./f-prot/</p>
<p>./install-f-prot.pl</p>
</blockquote>
<p> </p>
<p style="text-align: left;"><a class="keyword" href="http://d.hatena.ne.jp/keyword/%B4%F0%CB%DC%C5%AA">基本的</a>には質問はEnterでOkだけど、たまにYes,Noの質問もある。これはYでいいはず。</p>
<p>以下インストール時の文言。</p>
<p> </p>
<blockquote>
<p style="text-align: left;">(c) <a class="keyword" href="http://d.hatena.ne.jp/keyword/FRISK">FRISK</a> Software International</p>
</blockquote>
<p> </p>
<p style="text-align: left;"><a href="http://www.f-prot.com/">http://www.f-prot.com/</a></p>
<p> </p>
<p style="text-align: left;">You are about to install F-Prot Antivirus for <a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a> Workstations</p>
<p>on a <a class="keyword" href="http://d.hatena.ne.jp/keyword/Debian">Debian</a> <a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a> 2.6.32 running on <a class="keyword" href="http://d.hatena.ne.jp/keyword/i686">i686</a> into the '/f-prot'</p>
<p>directory</p>
<p> </p>
<p style="text-align: left;">Be warned that the documentation and user manuals assume that</p>
<p>F-Prot is installed in the default directory '/opt/f-prot'.</p>
<p> </p>
<p style="text-align: left;">F-Prot will run just fine from '/f-prot'</p>
<p>but you will of course have to adjust sample configuration and</p>
<p>such to match that change.</p>
<p> </p>
<p style="text-align: left;">/f-prot/f-prot.conf already exists, not copying /f-prot/f-prot.conf.default to that location</p>
<p> </p>
<p style="text-align: left;">Where do you want a symbolic link to 'F-Prot Antivirus command line scanner (fpscan)' to be created?</p>
<p>(Just press Enter to accept the default) [/usr/local/bin]:</p>
<p> </p>
<p style="text-align: left;">Where do you want a symbolic link to 'section 8 manuals' to be created?</p>
<p>(Just press Enter to accept the default) [/usr/local/man/man8]:</p>
<p> </p>
<p style="text-align: left;">/usr/local/man/man8 doesn't exist. Create it?</p>
<p>(Just press Enter to accept the default) [Y/n]: y</p>
<p> </p>
<p style="text-align: left;">Where do you want a symbolic link to 'section 1 manuals' to be created?</p>
<p>(Just press Enter to accept the default) [/usr/local/man/man1]:</p>
<p> </p>
<p style="text-align: left;">/usr/local/man/man1 doesn't exist. Create it?</p>
<p>(Just press Enter to accept the default) [Y/n]: y</p>
<p> </p>
<p style="text-align: left;">Where do you want a symbolic link to 'section 5 manuals' to be created?</p>
<p>(Just press Enter to accept the default) [/usr/local/man/man5]:</p>
<p> </p>
<p style="text-align: left;">/usr/local/man/man5 doesn't exist. Create it?</p>
<p>(Just press Enter to accept the default) [Y/n]: y</p>
<p> </p>
<p style="text-align: left;">Changing file <a class="keyword" href="http://d.hatena.ne.jp/keyword/access">access</a> permissions on the installed files and directories ...ok</p>
<p>Checking if you have an existing license key...yes</p>
<p> </p>
<p style="text-align: left;">Found an existing license key in /f-prot/license.key, updating <a class="keyword" href="http://d.hatena.ne.jp/keyword/antivir">antivir</a>.def ...</p>
<p> </p>
<p style="text-align: left;">Downloading update (%100)</p>
<p>We've generated the following crontab entries to update the</p>
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/antivir">antivir</a>.def file via fpupdate. Updates will be run hourly at a</p>
<p>randomly picked minute to distribute load, and thus make your updates</p>
<p>faster than if they were run during obvious high load times, e.g. on</p>
<p>the hour.</p>
<p> </p>
<p style="text-align: left;">The global crontab entry we made to add to /etc/crontab is the following:</p>
<p> </p>
<p style="text-align: left;">36 * * * * root /f-prot/fpupdate &gt; /dev/null</p>
<p> </p>
<p style="text-align: left;">Would you like to have this crontab appended to /etc/crontab?</p>
<p>(Just press Enter to accept the default) [Y/n]: y</p>
<p> </p>
<p style="text-align: left;">All done!</p>
<p> </p>
<p style="text-align: left;">If you reconfigured your MTA you should restart it now to activate the changes.</p>
<p> </p>
<p style="text-align: left;">Have a nice day</p>
<p> </p>
<p style="text-align: left;"><a class="keyword" href="http://d.hatena.ne.jp/keyword/Frisk">Frisk</a> software (www.f-prot.com)</p>
<p> </p>
<p style="text-align: left;">実行コマンドはこんな感じ。</p>
<p>結構コマンドは細かく指定できるそうなので調べてみるといいかも。私は<a href="http://mypace75.blog92.fc2.com/blog-entry-708.html" target="_blank">ここ</a>や<a href="http://www.sanko-oki.co.jp/linux/Virus_2.html" target="_blank">ここ</a>を参考にした。</p>
<p> </p>
<blockquote>
<p style="text-align: left;">fpscan --disinfect /home -o /var/log/fprot/scan.log</p>
</blockquote>
<p> </p>
<p style="text-align: left;">なお、現時点では定期的にスキャンするように設定されていないのでCronに設定を書き込んでおく。</p>
<p> </p>
<p style="text-align: left;">crontab -e</p>
<p> </p>
<blockquote>
<p style="text-align: left;">0 3 * * 3 fpscan --disinfect /home -o /var/log/fprot/scan.log</p>
</blockquote>
<p> </p>
<p style="text-align: left;"><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A6%A5%A4%A5%EB%A5%B9%C2%D0%BA%F6">ウイルス対策</a>はこんな感じ。</p>
<p>本当はほかにも<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EB%A1%BC%A5%C8%A5%AD%A5%C3%A5%C8">ルートキット</a>対策などをするべきなのかもしれないけど今回は割愛。折を見て入れる予定。</p>
<p> </p>
<p style="text-align: left;">つぎに<a class="keyword" href="http://d.hatena.ne.jp/keyword/SSH">SSH</a>関連のセキュリティ向上を行う。</p>
<p> </p>
<p style="text-align: left;">現在において<a class="keyword" href="http://d.hatena.ne.jp/keyword/SSH">SSH</a>はパスワード認証になっている。</p>
<p>ただし、これだと万が一パスワードが流出したり辞書攻撃などで見つかってしまった場合なすすべもなくなるので、鍵認証を導入してセキュリティ向上を図る。</p>
<p> </p>
<pre style="text-align: left;"><a class="keyword" href="http://d.hatena.ne.jp/keyword/ssh">ssh</a>-keygen -t <a class="keyword" href="http://d.hatena.ne.jp/keyword/rsa">rsa</a></pre>
<p>cd /home/ユーザー名/.<a class="keyword" href="http://d.hatena.ne.jp/keyword/ssh">ssh</a></p>
<p>mv ./id_<a class="keyword" href="http://d.hatena.ne.jp/keyword/rsa">rsa</a>.pub ./authorized_keys</p>
<p>chmod 600 authorized_keys</p>
<p> </p>
<p> </p>
<p style="text-align: left;">ついでにhomeディレクトリの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%DF%A5%C3%A5%B7%A5%E7%A5%F3">パーミッション</a>を変更して他のユーザーのディレクトリを参照できないようにする。</p>
<p>この場合homeディレクトリの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D1%A1%BC%A5%DF%A5%C3%A5%B7%A5%E7%A5%F3">パーミッション</a>は710や711でいいみたい。</p>
<p>また、できることなら<a class="keyword" href="http://d.hatena.ne.jp/keyword/SSH">SSH</a>に<a class="keyword" href="http://d.hatena.ne.jp/keyword/chroot">chroot</a>設定をしておいた方がいいとかどうとか。</p>
<p> </p>
<p style="text-align: left;"> </p>
<p> </p>
<p style="text-align: left;">次の記事に続く</p>